---
title: Virtual DOM은 빠르지 않지만 효율적이다.
date: "2023-11-09"
description: "모든 스택을 사용하는데는 합당한 이유가 필요하다. 하지만 나를 포함한 대부분의 현 시대의 FE 개발자들은 별 고민 없이 `React`를 사용할 것이라고 생각된다. 나는 문득 '왜 우리는 react를 사용하고 바닐라 js와 비교했을 때 어떤 장점이 있을까'라는 의문이 들었다. 그리고 그 중심에 virtual DOM이 있었고, 이를 이해하는 것이 의문을 해소하는 키 역할을 할 것이라 생각되어 조사해보았다."
---

### 들어가며

모든 스택을 사용하는데는 합당한 이유가 필요하다. 하지만 나를 포함한 대부분의 현 시대의 FE 개발자들은 별 고민 없이 `React`를 사용할 것이라고 생각된다. 나는 문득 '왜 우리는 react를 사용하고 바닐라 js와 비교했을 때 어떤 장점이 있을까'라는 의문이 들었다. 그리고 그 중심에 virtual DOM이 있었고, 이를 이해하는 것이 의문을 해소하는 키 역할을 할 것이라 생각되어 조사해보았다.

우선 결론부터 말하자면,

> REACT의 렌더링은 다른 툴 들에 비해 빠르지 않다. 다만 사용하는데 문제가 없을 정도로 충분히 빠르다.

### 브라우저의 렌더링 방식

화면을 표시하기 위해서 브라우저는 HTML과 CSS를 파싱해 DOM tree를 만든다. 그리고 이를 JS와 결합시켜 Render tree를 만들고, Layout과 paint 과정을 거쳐 화면을 표시한다.

> **과정**

1. DOM tree 제작
2. Render tree 제작
3. Layout, 모든 요소의 위치와 크기 계산
4. Paint, 요소의 외형을 그리는 작업을 수행

이 과정을 요소가 변경될 때 마다 계속해서 진행한다.

이때 바닐라 JS와 HTML을 이용하여 실제 DOM이 변경되면 매 변경 시 마다 리렌더링이 발생하게 된다. 예를 들면 하나의 데이터를 건들였는데 30개의 DOM 노드 변화가 발생한다면 30번의 리렌더링이 발생하게 된다.
_(사실 과장이고 브라우저는 batching 및 throttling 등 다양한 내부 최적화를 사용하여 불필요한 렌더링을 방지하기 때문에 30번 보다는 적게 일어난다)_

### Virtual DOM의 장점

반면 virtual DOM을 사용하게 되면 위와 같은 상황에서 성능을 향상시킨다. 데이터 변경 전 virtual DOM과 변경 후 virtual DOM을 비교하여 변경된 사항을 한번에 DOM에 전달한다. 이를 통해 렌더링 횟수를 줄여준다.

> **비교 과정**

1. 컴포넌트 상태 변경

   컴포넌트의 상태가 변경되면, React는 새로운 Virtual DOM 트리를 생성

2. Diffing 알고리즘

   이전 Virtual DOM 트리와 새로운 Virtual DOM 트리를 비교(이 과정을 'diffing'이라고 부름). React는 두 트리 사이의 차이점, 즉 변경된 부분만을 식별.

3. Batch Updates (일괄 업데이트)

   식별된 변경사항을 일괄적으로 실제 DOM에 적용. 이는 리플로우와 리페인트를 최소화하여 성능을 향상시킴.

virtual DOM을 비교하고 바뀐 부분만 체크하는 과정에서 시간이 소요되기 때문에 개별적인 렌더링 속도는 느려진다. 하지만 여러번 렌더링 하지않고 최적화를 통해 최소한으로 렌더링하기 때문에 이를 상쇄시키고 성능을 향상할 수 있는 것이다.

> #### 그럼 .. virtual DOM을 사용한 REACT가 더 빠르고 좋은거 아닌가요..? 아까는 빠르지 않다면서요..

라고 의문이 생길 수 있다.

위에서 virtual DOM이 더 빠르다고 느낀 이유는 최적화를 안한 실제 DOM과 비교했기 때문이다. 일반 DOM도 virtual DOM과 같이 최적화 과정을 거치게 되면 렌더링 횟수를 줄일 수 있고 심지어 더 높은 속도를 낼 수 있다. 하지만 최적화 과정에서 리소스가 많이 발생하게 된다. REACT는 이러한 최적화 과정이 이미 제공되어 있고 추상화되어 편하게 사용할 수 있을 뿐만 아니라 **충분히 빠르기** 때문에 효율적으로 사용할 수 있다.

### 결론

React가 항상 가장 빠른 솔루션을 제공하는 것은 아니다. 그럼에도 불구하고, React는 개발자에게 기본적인 최적화를 내장하고 있으며, 상태 관리와 DOM 조작을 효율적으로 할 수 있도록 돕는다. 또한, JS와 함께 React의 구성요소를 작성함으로써 개발 프로세스를 간소화한다.

이러한 장점들은 개발자가 웹 애플리케이션을 더 효과적으로 구축할 수 있게 만든다. 그러나 매우 높은 수준의 맞춤형 최적화를 필요로 하거나, 프로젝트가 너무 단순해서 Virtual DOM의 오버헤드가 오히려 성능 저하를 일으킬 수 있는 경우에는 다른 도구를 고려하는 것이 좋다.
